<svg viewBox="0 0 1400 450" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 28px sans-serif; fill: #1f2937; }
      .heading { font: bold 18px sans-serif; fill: #1f2937; }
      .text { font: 14px sans-serif; fill: #4b5563; }
      .small-text { font: 12px sans-serif; fill: #6b7280; }
      .box-green { fill: #d1fae5; stroke: #10b981; stroke-width: 3; }
      .box { fill: #ffffff; stroke: #9ca3af; stroke-width: 2; }
      .arrow { fill: none; stroke: #10b981; stroke-width: 3; }
      .circle { fill: #10b981; stroke: #065f46; stroke-width: 2; }
      .number { font: bold 20px sans-serif; fill: white; }
    </style>
    
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" class="title" text-anchor="middle">Diagram 4: Question Generation System</text>
  <line x1="100" y1="50" x2="1300" y2="50" stroke="#e5e7eb" stroke-width="2"/>
  <text x="700" y="75" class="text" text-anchor="middle">generateQuestion() function - How math problems are created</text>

  <!-- Step 1 -->
  <circle cx="100" cy="180" r="30" class="circle"/>
  <text x="100" y="190" class="number" text-anchor="middle">1</text>
  
  <rect x="160" y="140" width="180" height="80" rx="8" class="box-green"/>
  <text x="250" y="165" class="heading" text-anchor="middle">Select Operation</text>
  <text x="250" y="190" class="text" text-anchor="middle">+ - × ÷</text>
  <text x="250" y="210" class="text" text-anchor="middle">or BODMAS</text>

  <!-- Arrow -->
  <line x1="340" y1="180" x2="390" y2="180" class="arrow" marker-end="url(#arrowgreen)"/>

  <!-- Step 2 -->
  <circle cx="430" cy="180" r="30" class="circle"/>
  <text x="430" y="190" class="number" text-anchor="middle">2</text>
  
  <rect x="490" y="140" width="180" height="80" rx="8" class="box-green"/>
  <text x="580" y="165" class="heading" text-anchor="middle">Generate Numbers</text>
  <text x="580" y="185" class="small-text" text-anchor="middle">Based on level range</text>
  <text x="580" y="203" class="text" text-anchor="middle">Example: 1-10</text>
  <text x="580" y="218" class="text" text-anchor="middle">or 20-100</text>

  <!-- Arrow -->
  <line x1="670" y1="180" x2="720" y2="180" class="arrow" marker-end="url(#arrowgreen)"/>

  <!-- Step 3 -->
  <circle cx="760" cy="180" r="30" class="circle"/>
  <text x="760" y="190" class="number" text-anchor="middle">3</text>
  
  <rect x="820" y="140" width="180" height="80" rx="8" class="box-green"/>
  <text x="910" y="165" class="heading" text-anchor="middle">Create Question</text>
  <text x="910" y="185" class="small-text" text-anchor="middle">Build question object:</text>
  <text x="910" y="203" class="text" text-anchor="middle" fill="#3b82f6">text: "5 + 3"</text>
  <text x="910" y="218" class="text" text-anchor="middle" fill="#3b82f6">answer: 8</text>

  <!-- Arrow -->
  <line x1="1000" y1="180" x2="1050" y2="180" class="arrow" marker-end="url(#arrowgreen)"/>

  <!-- Step 4 -->
  <circle cx="1090" cy="180" r="30" class="circle"/>
  <text x="1090" y="190" class="number" text-anchor="middle">4</text>
  
  <rect x="1150" y="140" width="180" height="80" rx="8" class="box-green"/>
  <text x="1240" y="165" class="heading" text-anchor="middle">Add Hint</text>
  <text x="1240" y="185" class="small-text" text-anchor="middle">Educational strategy:</text>
  <text x="1240" y="203" class="text" text-anchor="middle">"Start with 5,</text>
  <text x="1240" y="218" class="text" text-anchor="middle">count up 3"</text>

  <!-- Special Logic Section -->
  <rect x="160" y="260" width="1170" height="150" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
  <text x="745" y="290" class="heading" text-anchor="middle" fill="#92400e">Smart Logic for Different Operations:</text>
  
  <!-- Division -->
  <rect x="180" y="310" width="350" height="80" rx="5" class="box"/>
  <text x="355" y="330" class="text" text-anchor="middle" font-weight="bold" fill="#ef4444">Division (÷)</text>
  <text x="190" y="350" class="small-text">1. Generate answer first (e.g., 4)</text>
  <text x="190" y="368" class="small-text">2. Generate divisor (e.g., 3)</text>
  <text x="190" y="386" class="small-text">3. Multiply: 4 × 3 = 12</text>
  <text x="190" y="404" class="text" fill="#10b981">Result: "12 ÷ 3" (always whole number!)</text>

  <!-- BODMAS -->
  <rect x="560" y="310" width="350" height="80" rx="5" class="box"/>
  <text x="735" y="330" class="text" text-anchor="middle" font-weight="bold" fill="#a855f7">BODMAS</text>
  <text x="570" y="350" class="small-text">Randomly choose pattern:</text>
  <text x="570" y="368" class="small-text">Option A: "5 + 3 × 2" (multiply first)</text>
  <text x="570" y="386" class="small-text">Option B: "(5 + 3) × 2" (brackets first)</text>
  <text x="570" y="404" class="text" fill="#10b981">Ensures proper order of operations</text>

  <!-- No Repeats -->
  <rect x="940" y="310" width="360" height="80" rx="5" class="box"/>
  <text x="1120" y="330" class="text" text-anchor="middle" font-weight="bold" fill="#3b82f6">No Repeats</text>
  <text x="950" y="350" class="small-text">Each question gets unique ID:</text>
  <text x="950" y="368" class="text" fill="#6b7280">Date.now() + Math.random()</text>
  <text x="950" y="386" class="small-text">Checks against current session</text>
  <text x="950" y="404" class="text" fill="#10b981">No duplicate questions in one game!</text>
</svg>