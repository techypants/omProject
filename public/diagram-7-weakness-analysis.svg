<svg viewBox="0 0 1200 550" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 28px sans-serif; fill: #1f2937; }
      .heading { font: bold 18px sans-serif; fill: #1f2937; }
      .text { font: 14px sans-serif; fill: #4b5563; }
      .small-text { font: 12px sans-serif; fill: #6b7280; }
      .box-red { fill: #fee2e2; stroke: #ef4444; stroke-width: 3; }
      .box-yellow { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; }
      .box-green { fill: #d1fae5; stroke: #10b981; stroke-width: 2; }
      .box { fill: #ffffff; stroke: #9ca3af; stroke-width: 2; }
      .arrow { fill: none; stroke: #374151; stroke-width: 3; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#374151" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" class="title" text-anchor="middle">Diagram 7: Smart Weakness Analysis</text>
  <line x1="100" y1="50" x2="1100" y2="50" stroke="#e5e7eb" stroke-width="2"/>
  <text x="600" y="75" class="text" text-anchor="middle">How the app identifies struggling areas and suggests practice</text>

  <!-- Step 1: Game History Input -->
  <rect x="50" y="120" width="280" height="180" rx="10" class="box-red"/>
  <text x="190" y="150" class="heading" text-anchor="middle">1. Game History</text>
  <text x="190" y="175" class="text" text-anchor="middle">(After completing game)</text>
  
  <rect x="70" y="190" width="240" height="95" rx="5" class="box"/>
  <text x="190" y="210" class="small-text" text-anchor="middle" font-weight="bold">Questions Answered:</text>
  <text x="80" y="230" class="text">Q1: 5 + 3 = 8 ✓ (addition)</text>
  <text x="80" y="250" class="text">Q2: 12 ÷ 3 = 5 ✗ (division)</text>
  <text x="80" y="270" class="text">Q3: 8 ÷ 2 = 3 ✗ (division)</text>

  <!-- Arrow -->
  <line x1="330" y1="210" x2="390" y2="210" class="arrow" marker-end="url(#arrowhead)"/>

  <!-- Step 2: Analysis -->
  <rect x="390" y="120" width="350" height="180" rx="10" class="box-yellow"/>
  <text x="565" y="150" class="heading" text-anchor="middle">2. analyzePerformance()</text>
  
  <rect x="410" y="165" width="310" height="125" rx="5" class="box"/>
  <text x="565" y="185" class="small-text" text-anchor="middle" font-weight="bold">Group by operation type:</text>
  
  <text x="420" y="210" class="text" font-weight="bold">Addition:</text>
  <text x="520" y="210" class="text">1 correct / 1 total =</text>
  <text x="690" y="210" class="text" fill="#10b981" font-weight="bold">100% ✓</text>
  
  <text x="420" y="235" class="text" font-weight="bold">Subtraction:</text>
  <text x="520" y="235" class="text">0 correct / 0 total =</text>
  <text x="690" y="235" class="text" fill="#6b7280">N/A</text>
  
  <text x="420" y="260" class="text" font-weight="bold">Division:</text>
  <text x="520" y="260" class="text">0 correct / 2 total =</text>
  <text x="690" y="260" class="text" fill="#ef4444" font-weight="bold">0% ✗</text>

  <!-- Arrow -->
  <line x1="740" y1="210" x2="800" y2="210" class="arrow" marker-end="url(#arrowhead)"/>

  <!-- Step 3: Check Threshold -->
  <rect x="800" y="120" width="350" height="180" rx="10" class="box-yellow"/>
  <text x="975" y="150" class="heading" text-anchor="middle">3. Check Threshold</text>
  
  <!-- Diamond decision -->
  <path d="M 975 165 L 1050 210 L 975 255 L 900 210 Z" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
  <text x="975" y="205" class="text" text-anchor="middle" font-weight="bold">Accuracy</text>
  <text x="975" y="222" class="text" text-anchor="middle" font-weight="bold">under 70%?</text>

  <rect x="820" y="270" width="310" height="20" rx="3" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="975" y="284" class="small-text" text-anchor="middle">If YES: Add to weaknesses array</text>

  <!-- Step 4: Result -->
  <rect x="50" y="340" width="1100" height="180" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="3"/>
  <text x="600" y="370" class="heading" text-anchor="middle" fill="#991b1b">4. Display Results to User</text>

  <!-- Good performance -->
  <rect x="80" y="390" width="480" height="110" rx="8" class="box-green"/>
  <text x="320" y="415" class="text" text-anchor="middle" font-weight="bold" fill="#065f46">If Performance is Good (70%+):</text>
  <text x="100" y="440" class="text">✓ Show congratulations message</text>
  <text x="100" y="460" class="text">✓ Award full XP points</text>
  <text x="100" y="480" class="text">✓ "No weaknesses found!"</text>

  <!-- Weakness found -->
  <rect x="590" y="390" width="520" height="110" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="850" y="415" class="text" text-anchor="middle" font-weight="bold" fill="#92400e">If Weakness Found (under 70%):</text>
  <text x="610" y="440" class="text">⚠️ Show: "You need to train harder on <tspan font-weight="bold">division</tspan>"</text>
  <text x="610" y="460" class="text">⚠️ Display special button:</text>
  <text x="620" y="480" class="text" font-weight="bold" fill="#ef4444">"Practice Division Problems"</text>

  <!-- Bottom note -->
  <rect x="50" y="535" width="1100" height="12" rx="3" fill="#a855f7"/>
  <text x="600" y="545" class="text" text-anchor="middle" fill="white" font-size="11" font-weight="bold">
    Clicking the practice button generates a new game with ONLY the weak operation type!
  </text>
</svg>